<!-- FORMULARIO HOMOLOGACION AUXILIAR -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3">
  <h4 class="text-muted">Acta de Inicio</h4>
</div>

<mat-horizontal-stepper class="p-5" [linear]="isLinear" #stepper>
  <mat-step [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup" (ngSubmit)="registerSetting()">

      <ng-template matStepLabel>Configuración</ng-template>

      <div class="form-row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
          <div class="form-row pt-3">

            <div class="form-group col-md-12">
              <label>Fecha de Socialización</label>
              <input matInput [matDatepicker]="picker_date" class="form-control rounded-0" placeholder="Fecha de la Socialización" formControlName="date_report"
                     [ngClass]="{ 'border-danger': submitted_first_form && rff.date_report.errors,
                                  'is-invalid': submitted_first_form && rff.date_report.errors
                                }">
              <div *ngIf="submitted_first_form && rff.date_report.errors" class="invalid-feedback">
                 <div *ngIf="rff.date_report.errors.required">La fecha de la sustentación es necesaria</div>
              </div>
              <input type="hidden" id="passeye-1">
              <div class="date-icon">
                <mat-datepicker-toggle matSuffix [for]="picker_date"></mat-datepicker-toggle>
                <mat-datepicker #picker_date></mat-datepicker>
              </div>
            </div>

            <div class="form-group col-md-12">
              <label>Fecha de Iniciación</label>
              <input matInput [matDatepicker]="picker_initial_date" class="form-control rounded-0" placeholder="Fecha inicial del proyecto" formControlName="initial_date_report"
                     [ngClass]="{ 'border-danger': submitted_first_form && rff.initial_date_report.errors,
                                  'is-invalid': submitted_first_form && rff.initial_date_report.errors
                                }">
              <div *ngIf="submitted_first_form && rff.initial_date_report.errors" class="invalid-feedback">
                 <div *ngIf="rff.initial_date_report.errors.required">La fecha de iniciación del proyecto es necesaria</div>
              </div>
              <input type="hidden" id="passeye-2">
              <div class="date-icon">
                <mat-datepicker-toggle matSuffix [for]="picker_initial_date"></mat-datepicker-toggle>
                <mat-datepicker #picker_initial_date></mat-datepicker>
              </div>
            </div>

            <div class="form-group col-md-12">
              <label>Fecha de Finalización</label>
              <input matInput [matDatepicker]="picker_end_date" class="form-control rounded-0" placeholder="Fecha final del proyecto" formControlName="end_date_report">
              <input type="hidden" id="passeye-3">
              <div class="date-icon">
                <mat-datepicker-toggle matSuffix [for]="picker_end_date"></mat-datepicker-toggle>
                <mat-datepicker #picker_end_date></mat-datepicker>
              </div>
            </div>

            <div class="form-group col-md-12">
              <label>Presupuesto</label>
              <input currencyMask  class="form-control rounded-0" placeholder="Presupuesto del proyecto (aprobado)" formControlName="budget_report"
                     [ngClass]="{ 'border-danger': submitted_first_form && rff.budget_report.errors,
                                  'is-invalid': submitted_first_form && rff.budget_report.errors
                                }">
              <div *ngIf="submitted_first_form && rff.budget_report.errors" class="invalid-feedback">
                 <div *ngIf="rff.budget_report.errors.required">El presupuesto del proyecto es necesario</div>
              </div>
            </div>

            <div class="form-group col-md-9">
              <label>Tipo de Convocatoria</label>
              <select class="form-control rounded-0" formControlName="type_convocatory_report"
                  [ngClass]="{ 'border-danger': submitted_first_form && rff.type_convocatory_report.errors,
                               'is-invalid': submitted_first_form && rff.type_convocatory_report.errors
                             }" >
                <option *ngFor="let type of list_convocatory_types" [value]="type.id_tipo_convocatoria_reporte  ">
                  {{type.nombre_tipo_convocatoria_reporte}}
                </option>
              </select>
              <div *ngIf="submitted_first_form && rff.type_convocatory_report.errors" class="invalid-feedback">
                <div *ngIf="rff.type_convocatory_report.errors.required">El tipo de convocatoria del reporte es necesario</div>
              </div>
            </div>
            <div class="form-group col-md-3">
              <label>Código/Número</label>
              <input type="text"  class="form-control rounded-0" placeholder="Código o número de la convocatoria" formControlName="code_convocatory_report"
                     [ngClass]="{ 'border-danger': submitted_first_form && rff.code_convocatory_report.errors,
                                  'is-invalid': submitted_first_form && rff.code_convocatory_report.errors
                                }">
              <div *ngIf="submitted_first_form && rff.code_convocatory_report.errors" class="invalid-feedback">
                 <div *ngIf="rff.code_convocatory_report.errors.required">El código o número del proyecto es necesario</div>
                 <div *ngIf="rff.code_convocatory_report.errors.maxlength">El campo debe contener máximo 10 caracteres</div>
                 <div *ngIf="rff.code_convocatory_report.errors.pattern">El campo sólo acepta números y letras</div>
              </div>
            </div>

            <div class="form-group col-md-12">
              <label>Título del Trabajo</label>
              <textarea rows="4" class="form-control rounded-0" placeholder="Nombre del trabajo" formControlName="title_report"
                     [ngClass]="{ 'border-danger': submitted_first_form && rff.title_report.errors,
                                  'is-invalid': submitted_first_form && rff.title_report.errors
                                }"></textarea>
              <div *ngIf="submitted_first_form && rff.title_report.errors" class="invalid-feedback">
                 <div *ngIf="rff.title_report.errors.required">El título del reporte es necesario</div>
                 <div *ngIf="rff.title_report.errors.maxlength">El campo debe contener máximo 300 caracteres</div>
                 <div *ngIf="rff.title_report.errors.pattern">El campo sólo acepta letras</div>
              </div>
            </div>

            <div class="col-md-12">
              <hr>
            </div>

            <div class="col-md-12">
              <button type="submit" class="btn btn-lightning      rounded-0 mb-2 mr-2">Guardar</button>
              <button type="button" class="btn btn-outline-danger rounded-0 mb-2 mr-2" (click)="removeSettings()">Cancelar</button>
            </div>

          </div>
        </div>
        <div class="col-md-3"></div>
      </div>

    </form>
  </mat-step>


  <mat-step [stepControl]="secondFormGroup">

    <form [formGroup]="secondFormGroup">
      <ng-template matStepLabel>Grupos de Investigación</ng-template>

      <div class="form-row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
          <div class="form-row pt-3">

            <div class="col-md-12">
              <div class="alert alert-danger" role="alert" *ngIf="this.secondFormGroup.controls['checkArray'].errors?.required">
                Se requiere una casilla de verificación, seleccione al menos un valor.
              </div>
            </div>
            <div class="col-md-12" *ngIf="!hide_form">
              <div class="my-3 p-3 bg-white rounded shadow-sm" *ngFor="let faculty of list_investigation_groups">
                <h6 class="border-bottom border-gray pb-2 mb-0">{{faculty.faculty_name}}</h6>
                <div class="media text-muted pt-3" *ngFor="let group of faculty.investigation_group; let last = last; let i = index">
                  <div class="media-body pb-3 mb-0 small lh-125 border-gray" [ngClass]="{'border-bottom': !last}">
                    <div class="d-flex justify-content-between align-items-center w-100">
                      <strong class="text-gray-dark">{{group.nombre_grupo_investigacion}}</strong>
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="{{group.nombre_grupo_investigacion}}" [value]="group.nombre_grupo_investigacion" (change)="onCheckboxChange($event)">
                        <label class="custom-control-label linkhand" for="{{group.nombre_grupo_investigacion}}"></label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class="col-md-3"></div>
      </div>
    </form>
  </mat-step>

  <mat-step>

    <form [formGroup]="thirdFormGroup" (ngSubmit)="registerMember()">
      <ng-template matStepLabel>Integrantes</ng-template>

      <div class="form-row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
          <div class="form-row pt-3">

            <div class="form-group col-md-12">
              <label>Integrante</label>
              <select class="form-control rounded-0" formControlName="report_member"
                  [ngClass]="{ 'border-danger': submitted_third_form && rmf.report_member.errors,
                               'is-invalid': submitted_third_form && rmf.report_member.errors
                             }" >
                <option *ngFor="let member of list_members" [ngValue]="member">
                  {{member.nombre_integrante}} {{member.apellido_integrante}} | {{member.nombre_tipo_integrante}}
                </option>
                <option *ngIf="messageListMembersForm">No se han registrado integrantes en el sistema</option>
              </select>
              <div *ngIf="submitted_third_form && rmf.report_member.errors" class="invalid-feedback">
                <div *ngIf="rmf.report_member.errors.required">El integrante del reporte es necesario</div>
              </div>
            </div>

            <div class="form-group col-md-12">
              <label>Cargo</label>
              <select class="form-control rounded-0" formControlName="report_member_position"
                  [ngClass]="{ 'border-danger': submitted_third_form && rmf.report_member_position.errors,
                               'is-invalid': submitted_third_form && rmf.report_member_position.errors
                             }" >
                <option *ngFor="let position of list_member_position" [ngValue]="position">
                  {{position.nombre_tipo_cargo_reporte}}
                </option>
              </select>
              <div *ngIf="submitted_third_form && rmf.report_member_position.errors" class="invalid-feedback">
                <div *ngIf="rmf.report_member_position.errors.required">El cargo del integrante del reporte es necesario</div>
              </div>
            </div>

            <div class="col-md-12">
              <hr>
            </div>

            <div class="col-md-12">
              <button type="submit" class="btn btn-lightning rounded-0 mb-2 mr-2">Agregar</button>
            </div>

            <div class="col-md-12">
              <hr>
            </div>

            <div class="col-md-12">
              <div class="my-3 p-3 bg-white rounded shadow-sm">
                <h6 class="border-bottom border-gray pb-2 mb-0">Listado de Integrantes</h6>
                <div class="pt-3" *ngIf="messageListMembers">
                  <div class="alert alert-info" role="alert">
                    No se han asociado integrantes al reporte
                  </div>
                </div>
                <div class="media text-muted pt-3" *ngFor="let member of report_members_c1, index as id">
                  <img src="./assets/img/unilibre/unilibre.png" width="32" height="32">
                  <div class="media-body pl-1 pb-3 mb-0 small lh-125 border-bottom border-gray">
                    <div class="d-flex justify-content-between align-items-center w-100">
                      <strong class="text-gray-dark">{{member.nombre_integrante}} {{member.apellido_integrante}}</strong>
                      <a class="btn-trash linkhand" (click)="deleteMember(id)">
                        Eliminar
                      </a>
                    </div>
                    <span class="d-block">{{member.nombre_tipo_cargo_reporte}} - {{member.nombre_tipo_integrante}}</span>
                  </div>
                </div>

                <small class="d-block text-right mt-3" *ngIf="!messageListMembers">
                  <button type="button" class="btn btn-outline-danger rounded-0 btn-sm" (click)="removeMembers()">Cancelar</button>
                </small>

              </div>
            </div>

          </div>
        </div>
        <div class="col-md-3"></div>
      </div>
    </form>

  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Finalizar</ng-template>
    <div class="pt-3">
      <button type="button" class="btn btn-primary rounded-0 mr-2"   (click)="generateReport()">Finalizar reporte</button>
      <button type="button" class="btn btn-outline-danger rounded-0" (click)="resetForms();stepper.reset()">Reiniciar</button>
    </div>
  </mat-step>
</mat-horizontal-stepper>
